{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Hakai CTD Processing Manual","text":"<p>This repository present and link the different components associated with the Hakai CTD Processing Workflow. The Hakai Processing Pipeline can be divided in the following components:</p> <ol> <li>Field Collection</li> <li>Submission and Annotation</li> <li>Processing</li> <li>Quality Control</li> <li>Distribution</li> </ol> <p>And summarized through the following flow diagram:</p> <p> </p>"},{"location":"1-field-data-collection/","title":"Field Collection","text":""},{"location":"1-field-data-collection/#field-data-collection","title":"Field Data Collection","text":"<p>Data is first collected in the field by the field crew. The minimum required equipment is a CTD instrument unit and a tablet or phone (Android or iOS) with the Device Magic application installed on it linked to the Hakai Device Magic account.</p>"},{"location":"1-field-data-collection/#field-metadata-from-form-device-magic-app","title":"Field Metadata from form (Device Magic app)","text":"<p>Every time the field crew is leaving on a survey, a new <code>CTD form</code> should be created within their tablet. To which is added all the survey-related information, all the drops completed during the survey including the miscasts ones should be added to the form as a drop.</p> <p>Every drop must be associated with a start/bottom/end time, a station, and a start/bottom/end location (highly recommended).</p>"},{"location":"1-field-data-collection/#ctd-instrument-rbr-maestroconcertoxr620-or-seabird-19v2","title":"CTD Instrument (RBR Maestro/Concerto/XR620 or Seabird 19V2)","text":"<p>Hakai workflow is compatible with two CTD instrument manufacturer and their respective following profiling instruments:</p>"},{"location":"1-field-data-collection/#sea-bird-scientific","title":"Sea-Bird Scientific","text":"<p>The compatible Seabird Scientific instruments include:</p> <ol> <li>SBE 19plusV2</li> <li>SBE 911 plus (potentially)</li> <li>SBE 25 plus) (potentially)</li> </ol> <p>Hakai as of now only supports the SBE 19V2 instrument, that being said, it would be possible to support with very little effort any other profiling instruments from the manufacturer. Please refer to the Seabird 19plusV2 Standard Operation Protocol manual for a more detailed walkthrough of the different steps associated with the use of the Seabird Instruments as recommended by the Hakai Institute.</p>"},{"location":"1-field-data-collection/#rbr","title":"RBR","text":"<p>The compatible RBR instruments include:</p> <ol> <li>XR-620</li> <li>Concerto (recommended Fast)</li> <li>Maestro (recommended Fast)</li> <li>Concerto3 (recommended Fast)</li> <li>Maestro3 (recommended Fast)</li> </ol> <p>Please refer to the Hakai RBR Instruments Standard Operation Protocol Manual for a more detailed walkthrough of the different steps associated with the use of the RBR Instruments as recommended by the Hakai Institute.</p>"},{"location":"1-field-data-collection/#bottle-mounted-pressure-gauges","title":"Bottle Mounted Pressure Gauges","text":"<p>The Hakai Institute uses small boats during its regular surveys which prevents the use of a larger rosette system for collecting water. Instead, Hakai relies on Niskin bottles of different volumes mounted at different locations on a line to sample specific target depths.</p> <p>The bottles are first lowered into the water column to reach the target depths. Once the bottles are at the right depth, a messenger is sent from the surface to trigger sequentially the different bottles which each at their turn releases another messenger which gets dropped below that bottle to trigger the next bottle below.</p> <p>In order to confirm the depth of each bottle when they get triggered, a small pressure gauge sensor (RBR Solo) is mounted on each bottle and records the pressure associated with each bottle every second. This pressure data can be used to derive the associated depth of each bottle.</p> <p>RBR Solo data is downloaded by the same software used by the RBR CTD instruments Ruskin</p>"},{"location":"1-field-data-collection/#field-data-storage","title":"Field Data Storage","text":""},{"location":"1-field-data-collection/#field-instrument-maintenance-forms","title":"Field Instrument Maintenance Forms","text":""},{"location":"2-data-submission/","title":"Submission","text":""},{"location":"2-data-submission/#field-data-and-metadata-upload","title":"Field Data and Metadata Upload","text":""},{"location":"2-data-submission/#field-data-submission","title":"Field Data Submission","text":"<p>Once a field survey is completed, save and submit the field form. Retrieve the corresponding lab form within the associated lab tablet and review the different fields entered in the field. Confirm the metadata submitted and complete the final submission of the lab form.</p> <p>Once submitted, those lab forms are sent to the Hakai Servers and integrated into our database.</p>"},{"location":"2-data-submission/#instrument-data-submission","title":"Instrument Data Submission","text":"<p>The data must be first downloaded from the CTD instruments following a survey through the manufacturer proprietary software ( see each respective seabird or RBR SOP manual for details)</p> <p>Once downloaded, the data needs to be manually uploaded to the Hakai Data Portal (if needed access request can be made here). Follow the present procedure:</p> <ol> <li>Login with your authorized email account</li> <li>Go to the CTD Upload page</li> <li>Select the appropriate Work Area</li> <li>Drag and drop the files downloaded from the instruments</li> <li>RBR *.rsk file (likely a single file per survey)</li> <li>RBR RText Engineering .txt +.hex file (only for older XR-620 units)</li> <li>Confirm that upload was executed successfully</li> </ol>"},{"location":"2-data-submission/#instrument-raw-data-ingestion","title":"Instrument Raw Data Ingestion","text":"<p>Once uploaded to the Hakai Server, the data is then copied and stored within the organization's Amazon S3 bucket.</p>"},{"location":"2-data-submission/#rbr","title":"RBR","text":""},{"location":"2-data-submission/#rsk-conversion","title":"RSK Conversion","text":"<p>RBR RSK format which is essentially an SQLite3 file which is following RBR's standard format is parsed to an R-Text equivalent file to be ingested within the Hakai Database.</p> <p>The MatLab Hakai tool used to convert the RSK file can be here https://github.com/HakaiInstitute/hakai-ctd-tools/blob/master/rbr-proc/RSK2HakaiJSON.m The tool essentially is a wrapper around the RSKTools MatLab package developed by RBR. The tool reads the RSK file via the RSKopen and RSKreaddata functions which loads the RSK data into a MatLab environment structure.</p> <p>The resulting structure is then stored as a JSON string within the header of the outputted file and the data is stored as a table following the same convention used by the RText format.</p> <p>The tool is deployed on the server as a docker container. This tool is used and compatible with both CTD and solo pressure gauge instruments.</p>"},{"location":"2-data-submission/#rtext-data-ingestion","title":"RText Data Ingestion","text":"<p>RText or RSK converted data is then parsed and ingested into the Hakai database through the <code>hakai-api</code> tool https://github.com/HakaiInstitute/hakai-api/blob/main/src/routes/ctd/utils/rbr/parse.js</p> <p>The tool relies on the RBR shortName convention to assign each data column to the corresponding database table column within the <code>ctd.raw_ctd_data</code> table.</p>"},{"location":"2-data-submission/#cast-detection","title":"Cast Detection","text":"<p>The \"cast detection tool\" is a JavaScript algorithm that is used to detect and split RBR CTD timeseries data into separate profiles. The tool can be used in two modes:</p> <ol> <li>Standard: The instrument is considered in the water if the conductivity exceeds the <code>0.95 mS/cm</code> threshold</li> <li>Contain Static Casts: Essentially relies on time gaps to split the timeseries in multiple drops.</li> </ol>"},{"location":"2-data-submission/#seabird","title":"Seabird","text":"<p>Seabird *.hex files are considered been each associated to a unique drop and for this reason the conversion and ingestion process is performed at the very beginning of the Seabird Data Processing step.</p>"},{"location":"2-data-submission/#field-data-and-metadata-annotation","title":"Field Data and Metadata Annotation","text":"<p>All CTD drops uploaded to the Hakai Portal needs to be associated with a corresponding drop made available through the Metadata CTD Forms field during the survey by the field technicians.</p> <p>To annotate drops associated with a survey:</p> <ol> <li>Go to the Hakai Portal CTD Annotation page</li> <li>Select the right work area</li> <li>Select one or many uploaded files to be annotated</li> <li>The server will try automatically to bring up the most likely associated drop provided within the Metadata CTD Forms.</li> <li>Once matched to a drop metadata, the page will warm you if:    a. The time difference between the form and the instrument detected drop start, (bottom, and end [RBR Only])    b. The latitude and longitude distance recorded is more than a kilometer from the given station.    c. The maximum depth reached by the instrument is significantly less or more than the target depth provided within the form.</li> <li>Click <code>SAVE ANNOTATIONS</code> if the suggested annotation is appropriate</li> </ol>"},{"location":"3-data-processing/","title":"Processing","text":""},{"location":"3-data-processing/#ctd-data-standardized-data-processing","title":"CTD Data Standardized Data Processing","text":"<p>Hakai follows the standard data processing procedures suggested by either the scientific community or the instrument manufacturer.</p> <p></p>"},{"location":"3-data-processing/#rbr-data-processing","title":"RBR Data Processing","text":"<p>The Hakai RBR CTD Profiles standard processing procedure follows the recommendations provided within the Report Guidelines for processing RBR CTD profiles and RBR recommendations.</p> <p>The main Matlab tool used to process Hakai RBR CTD profiles is maintained and available at hakai-ctd-tools/ctd-tools/rbr-proc.</p> <p>Where essentially the MatLab script process_unprocessed_hakai_profiles.m is run every 5 minutes on the Hakai server Hecate to retrieve and process the unprocessed profiles available within the Hakai database ctd.ctd_file_cast view through the API endpoint <code>/ctd/views/file/cast</code>:</p> <p>Only the profiles respecting the following API filter conditions are processed:</p> <pre><code>filterURL = [\n        'processing_stage=1_datCnv',...\n        '&amp;(status!=MISCAST|status=null)',....\n        '&amp;process_error=null',...\n        '&amp;device_model={XRX-620,RBRconcerto3,XR-620,RBRconcerto,RBRmaestro,RBRmaestro3}',...\n        '&amp;limit=-1'...\n        ];\n</code></pre> <p>The resulting processed data is then uploaded back to the Hakai Database ctd.ctd_cast_data table and the processing_stage associated with each specific processed cast is updated to <code>processing_stage = '8_rbr_processed'</code>.</p> <p>Any errors or warnings encountered are uploaded to:</p> <ul> <li>ctd.ctd_cast <code>processing_errors</code> column</li> <li>Sentry related project rbr-proc.</li> </ul>"},{"location":"3-data-processing/#static-deployment","title":"Static Deployment","text":"<p>A static deployment is a special case where the instrument has to be maintained at a specific location and depth for a minimum duration.</p> <p>This type of deployment has been implemented to provide the ability to sample regions associated with very shallow waters.</p> <p>To be considered a static measurement, a sample needs to respect the following conditions:</p> <p>Note</p> <pre><code>To be considered a static measurement, a sample needs to respect the following conditions:\n\n1. The instrument needs to be **maintained at a specific location and depth for at least 2 minutes and 30 seconds** (We recommend leaving the instrument for at least 3 minutes).\n2. The depth throughout that period can only vary by either 10cm, 33% of the depth or up to 1m, whichever is greater.\n3. The instrument needs to be deeper than 10cm in the water.\n</code></pre>"},{"location":"3-data-processing/#dynamic-deployment","title":"Dynamic Deployment","text":"<p>The dynamic deployment corresponds to a profile measurement. For a more detailed description of the procedure as recommended by the Hakai Institute, please refer to the Hakai CTD Profile Data Processing Manual.</p>"},{"location":"3-data-processing/#seabird-data-processing","title":"Seabird Data Processing","text":"<p>Hakai Seabird Data Processing workflow follows closely the recommendations provided by Sea-Bird within the SBE Data Processing Manual. Hakai essentially uses a Python wrapper to interface the Seabird SBEDataProcessing software to run the different processing steps involved in the standard processing of the Seabird CTD data.</p> <p>The Python wrapper to interface the Seabird SBEDataProcessing software maintained and available within the hakai-ctd-tools/ctd-tools/seabird-proc/ repository.</p> <p>The python wrapper match for a given SBE hex file, the related instrument serial number, and the closest xmlcon calibration file available within the xmlcon files directory prior to the collection date.</p> <p>Once the data is converted from their raw hexadecimal data to the engineering format a series of processing steps are applied to the data by following the nearest in time prior processing parameter PSA files associated with this instrument serial number within the PSA folder.</p> <p>Since the SBEDataProcessing Software is only available for Windows. The tool is run within a dedicated server hosted within the Hakai Victoria Wharf Street office.</p>"},{"location":"4-data-quality-control/","title":"Quality Control","text":""},{"location":"4-data-quality-control/#hakai-ctd-data-qa-qc","title":"Hakai CTD Data QA QC","text":"<p>Hakai uses a unique tool to automatically QC the CTD profile data. The QCing tool relies on the IOOS_QC packaged and a series of in-house tests.</p> <p>The general QAQC workflow is summarized in the following diagram:</p> <p></p>"},{"location":"4-data-quality-control/#automated-data-qa-qc-provisional-data","title":"Automated Data QA QC (provisional data)","text":"<p>The automated QC tool is available and maintained within the hakai-profile-qaqc repository.</p> <p>The tool runs essentially a series of tests available within the IOOS QC package and a series of in-house tests.</p> <p>The following configuration files are used to apply the different tests to each individual variable:</p> <ol> <li>IOOS QC Config</li> <li>Hakai Tests Configuration</li> <li>Hakai Profiles Grey List: Hakai's Grey List overwrite any flag values obtained through the different test for a given one.</li> </ol> <p>For a more detailed description of the different tests applied, please refer to the tests_description section.</p>"},{"location":"4-data-quality-control/#manual-review-qa-qc-research-ready-data","title":"Manual Review QA QC (research-ready data)","text":"<p>A Manual Review Process is completed by a designated person who reviews each individual profile and applies a flag to each individual variable profile. Only the data associated with an <code>AV</code> flag value are then considered and presented through the Hakai Research Dataset.</p> <p>The Hakai manually QCed log is retrievable through the Hakai Portal download page as <code>CTD QC Tool</code> sample type and within the Hakai <code>ctd.ctd_qc</code> table within the Hakai Database.</p>"},{"location":"5-data-distribution/","title":"Distribution","text":""},{"location":"5-data-distribution/#hakai-data-distribution","title":"Hakai Data Distribution","text":"<p>CTD Data handled and processed by the Hakai Institute is made available through different sources.</p> <ol> <li>Hakai Data Portal: https://hecate.hakai.org/portal2<ul> <li>Raw Manufacturer Proprietary Files</li> <li>Raw Data Converted</li> <li>Processed Data</li> <li>Manually QCed research-ready data (soon)</li> </ul> </li> <li>Hakai ERDDAP: https://catalogue.hakai.org/erddap<ul> <li>Processed Data</li> <li>Manually QCed research-ready data (soon)</li> </ul> </li> <li>CIOOS Pacific ERDDAP (soon for non-hakai organizations)</li> </ol>"}]}